apiVersion: v1
kind: ConfigMap
metadata:
  name: authelia-config
  namespace: authkit-demo
data:
  configuration.yml: |
    server:
      address: 'tcp://:9091'
      disable_healthcheck: false

    log:
      level: debug

    theme: auto

    identity_validation:
      reset_password:
        # Obrigatório mesmo se não usar reset de senha
        jwt_secret: a_very_important_secret_change_me

    authentication_backend:
      ldap:
        implementation: custom
        address: ldap://ldap:389
        timeout: 5s
        start_tls: false
        base_dn: dc=company,dc=com
        additional_users_dn: ou=users
        users_filter: (&({username_attribute}={input})(objectClass=person))
        additional_groups_dn: ou=groups
        groups_filter: (&(member={dn})(objectClass=groupOfNames))
        user: cn=admin,dc=company,dc=com
        password: adminpassword
        attributes:
          username: uid
          display_name: displayName
          mail: mail
          group_name: cn

    access_control:
      default_policy: deny
      rules:
        # Regra para o próprio Authelia
        - domain: "auth.company.com"
          policy: one_factor
        # Regra para o Dagster
        - domain: "dagster.company.com"
          policy: one_factor

    session:
      name: authelia_session
      same_site: lax
      secret: another_very_important_secret_change_me
      expiration: 1h
      inactivity: 5m
      # Esta seção estava faltando e é obrigatória
      cookies:
        - domain: 'company.com'
          authelia_url: 'https://auth.company.com'
          default_redirection_url: 'https://dagster.company.com'

    regulation:
      max_retries: 5
      find_time: 2m
      ban_time: 5m

    storage:
      encryption_key: a1b2c3d4e5f6a1b2c3d4e5f6a1b2c3d4e5f6a1b2c3d4e5f6a1b2c3d4e5f61234
      local:
        path: /data/db.sqlite3

    notifier:
      filesystem:
        filename: /data/notification.txt